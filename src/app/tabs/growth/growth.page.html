<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Breastfeeding Progress</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="showQuickLogOptions()" fill="clear" class="quick-log-button">
        <ion-icon name="flash" slot="start"></ion-icon>
        Quick
      </ion-button>
      <ion-button (click)="openAddModal()">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="content-container">
    
    <!-- Baby Info & Star Performers -->
    <div class="baby-info-card" *ngIf="selectedBaby">
      <div class="baby-avatar">
        <ion-icon name="baby"></ion-icon>
      </div>
      <div class="baby-details">
        <h2>{{ selectedBaby.name }}</h2>
        <p>{{ calculateBabyAge() }}</p>
        <p class="birth-info">Born {{ formatDate(selectedBaby.dateOfBirth) }}</p>
        <div class="star-performer-badge" *ngIf="starPerformers.length > 0 && starPerformers[0].userId === user.uid">
          <ion-icon name="star"></ion-icon>
          <span>Star Performer #{{ starPerformers[0].rank }}</span>
        </div>
      </div>
      <ion-button fill="clear" (click)="openBabySelector()" *ngIf="user && user.babies && user.babies.length > 1" class="baby-selector-button">
        <ion-icon name="chevron-down" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <!-- LactApp-Style Timeline Header -->
    <div class="timeline-header-section">
      <div class="timeline-background">
        <div class="timeline-title">
          <h3>TIMELINE</h3>
          <span class="timeline-subtitle">Baby's Development Journey</span>
        </div>
        
        <div class="timeline-visual-horizontal">
          <div class="timeline-scroll-container" #timelineScrollContainer>
            <div class="timeline-weeks-strip">
              <div 
                *ngFor="let item of (timelineData$ | async)?.allWeeks || []; let i = index"
                class="week-marker-horizontal"
                [class.current-week]="item.weekStart === getCurrentWeek()"
                [class.completed-week]="item.weekStart < getCurrentWeek()"
                [class.upcoming-week]="item.weekStart > getCurrentWeek()"
                (click)="openSpecificWeekModal(item)">
                
                <div class="week-pin" [style.background-color]="item.color">
                  <ion-icon [name]="item.icon"></ion-icon>
                </div>
                
                <div class="week-number-badge" [style.background-color]="item.color">
                  <span class="week-number">{{ item.weekStart }}</span>
                </div>
                
                <div class="week-title">{{ item.shortTitle }}</div>
              </div>
            </div>
          </div>
          
          <div class="timeline-navigation">
            <ion-button fill="clear" size="small" (click)="scrollTimelineLeft()" class="timeline-nav-button">
              <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button fill="clear" size="small" (click)="scrollTimelineRight()" class="timeline-nav-button">
              <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
        </div>
        
        <div class="timeline-cards-preview">
          <div class="preview-card active" *ngIf="getCurrentTimelineItem()" (click)="openTimelineModal()">
            <div class="card-icon" [style.background-color]="getCurrentTimelineItem()?.color">
              <ion-icon [name]="getCurrentTimelineItem()?.icon"></ion-icon>
            </div>
            <div class="card-content">
              <h4>{{ getCurrentTimelineItem()?.title }}</h4>
              <p>{{ getCurrentTimelineItem()?.description }}</p>
            </div>
            <div class="see-more" (click)="openTimelineModal(); $event.stopPropagation()">
              <span>SEE MORE</span>
              <ion-icon name="chevron-forward"></ion-icon>
            </div>
          </div>
          
          <div class="preview-card upcoming" *ngIf="getUpcomingTimelineItem()" (click)="openTimelineModal()">
            <div class="card-icon locked" [style.background-color]="getUpcomingTimelineItem()?.color">
              <ion-icon name="lock-closed"></ion-icon>
            </div>
            <div class="card-content">
              <h4>{{ getUpcomingTimelineItem()?.title }}</h4>
              <p>Coming in {{ getWeeksUntilUpcoming() }} week{{ getWeeksUntilUpcoming() !== 1 ? 's' : '' }}</p>
            </div>
          </div>
        </div>
        
        <div class="timeline-action">
          <span class="see-all-link" (click)="openTimelineModal()">SEE ALL</span>
        </div>
      </div>
    </div>

    <!-- Tab Selector -->
    <div class="tab-selector">
      <ion-segment [(ngModel)]="selectedTab" (ionChange)="onTabChange($event)">
        <ion-segment-button value="daily">
          <ion-label>Daily Tracking</ion-label>
        </ion-segment-button>
        <ion-segment-button value="weight">
          <ion-label>Weight & Size</ion-label>
        </ion-segment-button>
        <ion-segment-button value="stool">
          <ion-label>Stool Track</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Recent Records Reference (for Daily Tab) -->
    <div class="recent-reference" *ngIf="selectedTab === 'daily' && (recentRecords$ | async) as recentRecords">
      <h3>Last 3 Days Reference</h3>
      <div class="reference-cards">
        <div *ngFor="let record of recentRecords.slice(0, 3)" class="reference-card">
          <div class="reference-date">{{ formatDate(record.date) }}</div>
          <div class="reference-metrics">
            <span>{{ record.directFeedingSessions }} feeds</span>
            <span>{{ record.pumpingSessions }} pumps</span>
            <span *ngIf="record.mood">{{ record.mood?.emoji }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Timeline Content -->
    <div class="tab-content" *ngIf="selectedTab === 'timeline'">
      <div class="timeline-container" *ngIf="timelineData$ | async as timelineData">
        
        <!-- Current Week Header -->
        <div class="timeline-header">
          <div class="week-indicator">
            <div class="week-marker">
              <ion-icon name="location"></ion-icon>
            </div>
            <div class="week-info">
              <h2>Week {{ timelineData.currentWeek }}</h2>
              <p>{{ calculateBabyAge() }}</p>
            </div>
          </div>
        </div>

        <!-- Timeline Items -->
        <div class="timeline-items">
          <div *ngFor="let item of timelineData.items; let i = index" 
               class="timeline-item"
               [class.current-item]="timelineData.currentWeek >= item.weekStart && timelineData.currentWeek <= item.weekEnd"
               [class.completed-item]="timelineData.currentWeek > item.weekEnd"
               [class.upcoming-item]="timelineData.currentWeek < item.weekStart">
            
            <div class="timeline-connector" *ngIf="i > 0"></div>
            
            <div class="timeline-marker" [style.background-color]="item.color">
              <ion-icon [name]="item.icon"></ion-icon>
            </div>
            
            <div class="timeline-content">
              <div class="timeline-card">
                <div class="card-header">
                  <div class="week-range">
                    <span *ngIf="item.weekStart === item.weekEnd">Week {{ item.weekStart }}</span>
                    <span *ngIf="item.weekStart !== item.weekEnd">Weeks {{ item.weekStart }}-{{ item.weekEnd }}</span>
                  </div>
                  <ion-chip [color]="item.color" size="small">
                    {{ getCategoryLabel(item.category) }}
                  </ion-chip>
                </div>
                
                <h3>{{ item.title }}</h3>
                <p class="description">{{ item.description }}</p>
                
                <!-- What to Expect -->
                <div class="expectation-section" *ngIf="item.whatToExpect && item.whatToExpected.length > 0">
                  <h4>üíï What to Expect:</h4>
                  <ul class="expectation-list">
                    <li *ngFor="let expectation of item.whatToExpect">{{ expectation }}</li>
                  </ul>
                </div>
                
                <!-- Tips -->
                <div class="tips-section" *ngIf="item.tips && item.tips.length > 0">
                  <h4>‚ú® Helpful Tips:</h4>
                  <ul class="tips-list">
                    <li *ngFor="let tip of item.tips">{{ tip }}</li>
                  </ul>
                </div>
                
                <!-- When to Worry -->
                <div class="worry-section" *ngIf="item.whenToWorry && item.whenToWorry.length > 0">
                  <h4>üö® When to Contact Your Doctor:</h4>
                  <ul class="worry-list">
                    <li *ngFor="let worry of item.whenToWorry">{{ worry }}</li>
                  </ul>
                </div>
                
                <div class="card-footer">
                  <ion-button 
                    fill="clear" 
                    size="small" 
                    *ngIf="timelineData.currentWeek >= item.weekStart && timelineData.currentWeek <= item.weekEnd">
                    <ion-icon name="checkmark-circle" slot="start"></ion-icon>
                    Mark as Experienced
                  </ion-button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Upcoming Milestones -->
        <div class="upcoming-section" *ngIf="timelineData.upcomingMilestones.length > 0">
          <h3>üåü Coming Up Next</h3>
          <div class="upcoming-cards">
            <div *ngFor="let milestone of timelineData.upcomingMilestones" class="upcoming-card">
              <div class="upcoming-icon" [style.background-color]="milestone.color">
                <ion-icon [name]="milestone.icon"></ion-icon>
              </div>
              <div class="upcoming-content">
                <h4>{{ milestone.title }}</h4>
                <p>Week {{ milestone.weekStart }}<span *ngIf="milestone.weekStart !== milestone.weekEnd">-{{ milestone.weekEnd }}</span></p>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>

    <!-- Daily Tracking Content -->
    <div class="tab-content" *ngIf="selectedTab === 'daily'">
      <div class="section">
        <h3 class="section-title">Recent Daily Records</h3>
        <div class="records-list" *ngIf="growthRecords$ | async as records; else noDailyRecords">
          <div *ngFor="let record of records | slice:0:5" class="record-card daily-record">
            <div class="record-header">
              <span class="record-date">{{ formatDate(record.date) }}</span>
              <div class="record-mood" *ngIf="record.mood.value">
                <span class="mood-emoji">{{ getMotherMoodEmoji(record.mood.value) }}</span>
                <span class="mood-label">{{ getMotherMoodLabel(record.mood.value) }}</span>
              </div>
            </div>
            
            <div class="feeding-metrics">
              <div class="metric-group">
                <h4>Feeding</h4>
                <div class="metrics-grid">
                  <div class="metric">
                    <span class="metric-label">Start Time</span>
                    <span class="metric-value">{{ record.startTime }}</span>
                  </div>
                  <div class="metric">
                    <span class="metric-label">End Time</span>
                    <span class="metric-value">{{ record.endTime }}</span>
                  </div>
                </div>
              </div>
              
              <div class="metric-group">
                <h4>Details</h4>
                <div class="metrics-grid">
                  <div class="metric">
                    <span class="metric-label">Breast Side</span>
                    <span class="metric-value">{{ record.breastSide | titlecase }}</span>
                  </div>
                  <div class="metric">
                    <span class="metric-label">Pain Level</span>
                    <span class="metric-value">{{ record.painLevel }}/10</span>
                  </div>
                </div>
              </div>
              
              <div class="metric-group" *ngIf="record.supplement">
                <h4>Supplement</h4>
                <div class="metrics-grid">
                  <div class="metric">
                    <span class="metric-label">Type</span>
                    <span class="metric-value">{{ record.supplement | titlecase }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="record-notes" *ngIf="record.notes">
              <p>{{ record.notes }}</p>
            </div>
            
            <div class="voice-indicator" *ngIf="record.enteredViaVoice">
              <ion-icon name="mic"></ion-icon>
              <span>Entered via voice</span>
            </div>
          </div>
        </div>
        
        <ng-template #noDailyRecords>
          <div class="empty-state">
            <ion-icon name="calendar"></ion-icon>
            <h4>No daily records yet</h4>
            <p>Start tracking your daily breastfeeding progress</p>
            <ion-button fill="outline" (click)="openAddRecordModal()">
              Add First Record
            </ion-button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Weight Tracking Content -->
    <div class="tab-content" *ngIf="selectedTab === 'weight'">
      <!-- CDC Weight Chart -->
      <app-weight-chart 
        [weightRecords]="(weightRecords$ | async) || []"
        [babyGender]="getBabyGenderForChart(selectedBaby?.gender)"
        [babyBirthDate]="selectedBaby?.dateOfBirth || getNewDate()">
      </app-weight-chart>

      <div class="section">
        <h3 class="section-title">Weight & Size Records</h3>
        <div class="records-list" *ngIf="weightRecords$ | async as weightRecords; else noWeightRecords">
          <div *ngFor="let record of weightRecords | slice:0:10" class="record-card weight-record">
            <div class="weight-info">
              <span class="weight-date">{{ formatDate(record.date) }}</span>
              <div class="weight-values">
                <span class="weight-value">{{ record.weight }} kg</span>
                <span class="height-value" *ngIf="record.height">{{ record.height }} cm</span>
              </div>
            </div>
            <div class="weight-notes" *ngIf="record.notes">
              <p>{{ record.notes }}</p>
            </div>
          </div>
        </div>
        
        <ng-template #noWeightRecords>
          <div class="empty-state">
            <ion-icon name="scale"></ion-icon>
            <h4>No weight & size records yet</h4>
            <p>Start tracking your baby's weekly weight progress</p>
            <ion-button fill="outline" (click)="openAddWeightModal()">
              Add First Record
            </ion-button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Stool Tracking Content -->
    <div class="tab-content" *ngIf="selectedTab === 'stool'">
      <div class="section">
        <h3 class="section-title">Stool Records</h3>
        <div class="records-list" *ngIf="stoolRecords$ | async as stoolRecords; else noStoolRecords">
          <div *ngFor="let record of stoolRecords | slice:0:10" class="record-card stool-record">
            <div class="stool-header">
              <span class="stool-date">{{ formatDate(record.date) }}</span>
              <span class="stool-time">{{ record.time }}</span>
            </div>
            <div class="stool-details">
              <div class="stool-attribute">
                <span class="attribute-label">Color:</span>
                <div class="color-indicator" [style.background-color]="record.color.color"></div>
                <span class="attribute-value">{{ record.color.label }}</span>
              </div>
              <div class="stool-attribute">
                <span class="attribute-label">Texture:</span>
                <ion-icon [name]="record.texture.icon" class="texture-icon"></ion-icon>
                <span class="attribute-value">{{ record.texture.label }}</span>
              </div>
              <div class="stool-attribute">
                <span class="attribute-label">Size:</span>
                <ion-icon [name]="record.size.icon" class="size-icon"></ion-icon>
                <span class="attribute-value">{{ record.size.label }}</span>
              </div>
            </div>
            <div class="stool-notes" *ngIf="record.notes">
              <p>{{ record.notes }}</p>
            </div>
          </div>
        </div>
        
        <ng-template #noStoolRecords>
          <div class="empty-state">
            <ion-icon name="medical"></ion-icon>
            <h4>No stool records yet</h4>
            <p>Start tracking your baby's stool patterns for health insights</p>
            <ion-button fill="outline" (click)="openAddStoolModal()">
              Add First Record
            </ion-button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Star Performers Section -->
    <div class="section" *ngIf="starPerformers.length > 0">
      <h3 class="section-title">‚≠ê This Week's Star Performers</h3>
      <div class="star-performers-list">
        <div *ngFor="let performer of starPerformers" class="performer-card" [class.current-user]="performer.userId === user?.uid">
          <div class="performer-rank">
            <ion-icon name="trophy" [class.gold]="performer.rank === 1" [class.silver]="performer.rank === 2" [class.bronze]="performer.rank === 3"></ion-icon>
            <span>#{{ performer.rank }}</span>
          </div>
          <div class="performer-info">
            <h4>{{ performer.userName }}</h4>
            <p>{{ performer.consistencyScore }} entries this week</p>
            <div class="elite-badge" *ngIf="performer.isEliteCandidate">
              <ion-icon name="star"></ion-icon>
              <span>Elite Candidate</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Baby Selector Modal -->
  <ion-modal [isOpen]="showBabySelector" (didDismiss)="closeBabySelector()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Select Baby</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeBabySelector()">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <div class="baby-selector-content">
          <div class="baby-selector-header">
            <h3>Choose which baby to track</h3>
            <p>Select the baby you want to add data for</p>
          </div>
          
          <div class="babies-list">
            <div 
              *ngFor="let baby of user?.babies"
              class="baby-option"
              [class.selected]="selectedBaby?.id === baby.id"
              (click)="selectBaby(baby)">
              <div class="baby-option-avatar">
                <ion-icon name="baby"></ion-icon>
              </div>
              <div class="baby-option-info">
                <h4>{{ baby.name }}</h4>
                <p>{{ baby.gender | titlecase }}</p>
                <p class="baby-age">{{ calculateBabyAge() }}</p>
              </div>
              <ion-icon name="checkmark-circle" class="selected-icon" *ngIf="selectedBaby?.id === baby.id"></ion-icon>
            </div>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Daily Record Modal -->
  <ion-modal [isOpen]="showAddRecordModal" (didDismiss)="closeAddRecordModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Add Daily Record</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeAddRecordModal()">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <form [formGroup]="addRecordForm" class="add-record-form">
          
          <!-- Baby Info Header -->
          <div class="baby-info-header" *ngIf="selectedBaby">
            <div class="baby-avatar">
              <ion-icon name="happy"></ion-icon>
            </div>
            <div class="baby-details">
              <h3>{{ selectedBaby.name }}</h3>
              <p>{{ calculateBabyAge() }}</p>
            </div>
          </div>

          <!-- Smart Voice Input Section -->
          <div class="smart-voice-section" *ngIf="isVoiceSupported()">
            <div class="voice-input-header">
              <h5>üé§ Smart Voice Input</h5>
              <p>Say something like: "Baby fed 8 times today, each session lasted 20 minutes, pumped 3 times and got 150ml total"</p>
            </div>
            
            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="startSmartVoiceInput()"
              [disabled]="isRecording || isProcessingVoice"
              class="smart-voice-button">
              <ion-icon [name]="isRecording ? 'stop' : 'mic'" slot="start"></ion-icon>
              <span *ngIf="!isRecording && !isProcessingVoice">Start Voice Input</span>
              <span *ngIf="isRecording">Listening...</span>
              <span *ngIf="isProcessingVoice">Processing...</span>
            </ion-button>
            
            <div class="voice-status" *ngIf="voiceTranscript || isProcessingVoice">
              <div class="voice-transcript" *ngIf="voiceTranscript">
                <h6>Voice Input:</h6>
                <p>"{{ voiceTranscript }}"</p>
              </div>
              
              <div class="voice-summary">
                <p class="summary-text">{{ getVoiceInputSummary() }}</p>
                <ion-button fill="clear" size="small" (click)="clearVoiceInput()">
                  <ion-icon name="close" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </div>
            
            <div class="voice-examples">
              <h6>Example phrases:</h6>
              <ul>
                <li>"Baby fed 6 times today, feeling great"</li>
                <li>"Pumped 4 times and got 200ml, baby seems happy"</li>
                <li>"Had 8 wet diapers and 3 dirty ones, feeling tired"</li>
              </ul>
            </div>
          </div>

          <!-- Breastfeeding Time -->
          <div class="form-section">
            <h4>Breastfeeding time ?</h4>
            
            <div class="form-row">
              <div class="form-group half-width">
                <label class="field-label">Start</label>
                <ion-item lines="none" class="input-item time-input">
                  <ion-input
                    formControlName="startTime"
                    type="time"
                    [class.error]="addRecordForm.get('startTime')?.invalid && addRecordForm.get('startTime')?.touched">
                  </ion-input>
                </ion-item>
                <div class="error-message" *ngIf="addRecordForm.get('startTime')?.invalid && addRecordForm.get('startTime')?.touched">
                  {{ getErrorMessage('startTime') }}
                </div>
              </div>
              
              <div class="form-group half-width">
                <label class="field-label">End</label>
                <ion-item lines="none" class="input-item time-input">
                  <ion-input
                    formControlName="endTime"
                    type="time"
                    [class.error]="addRecordForm.get('endTime')?.invalid && addRecordForm.get('endTime')?.touched">
                  </ion-input>
                </ion-item>
                <div class="error-message" *ngIf="addRecordForm.get('endTime')?.invalid && addRecordForm.get('endTime')?.touched">
                  {{ getErrorMessage('endTime') }}
                </div>
              </div>
            </div>
          </div>

          <!-- Breast Side Selection -->
          <div class="form-section">
            <h4>Breast side ?</h4>
            <div class="selection-grid breast-side-grid">
              <div 
                *ngFor="let side of breastSideOptions"
                class="selection-option breast-side-option"
                [class.selected]="selectedBreastSide?.value === side.value"
                (click)="selectBreastSide(side)">
                <div class="breast-side-icon">
                  <ion-icon [name]="side.icon"></ion-icon>
                </div>
                <span class="option-label">{{ side.label }}</span>
              </div>
            </div>
          </div>

          <!-- Supplement Selection -->
          <div class="form-section">
            <h4>Supplement ?</h4>
            <div class="selection-grid supplement-grid">
              <div 
                *ngFor="let supplement of supplementOptions"
                class="selection-option supplement-option"
                [class.selected]="selectedSupplement?.value === supplement.value"
                (click)="selectSupplement(supplement)">
                <div class="supplement-icon">
                  <ion-icon [name]="supplement.icon"></ion-icon>
                </div>
                <span class="option-label">{{ supplement.label }}</span>
              </div>
            </div>
          </div>

          <!-- Pain Level -->
          <div class="form-section">
            <h4>Pain ?</h4>
            <p class="section-note">Consider 0 is no pain and 10 is a lot of pain</p>
            
            <div class="pain-level-container">
              <div class="pain-level-display">{{ painLevel }}</div>
              <ion-range
                min="0"
                max="10"
                step="1"
                [(ngModel)]="painLevel"
                (ionInput)="setPainLevel($event.detail.value)"
                color="secondary"
                class="pain-slider">
                <ion-label slot="start">0</ion-label>
                <ion-label slot="end">10</ion-label>
              </ion-range>
            </div>
          </div>

          <!-- Lipstick Shape -->
          <div class="form-section">
            <h4>Lipstick ?</h4>
            <p class="section-note">It can change after the feed</p>
            <div class="selection-grid lipstick-grid">
              <div 
                *ngFor="let shape of lipstickShapeOptions"
                class="selection-option lipstick-option"
                [class.selected]="selectedLipstickShape?.value === shape.value"
                (click)="selectLipstickShape(shape)">
                <div class="lipstick-icon">
                  <ion-icon [name]="shape.icon"></ion-icon>
                </div>
                <span class="option-label">{{ shape.label }}</span>
              </div>
            </div>
          </div>

          <!-- How do you feel -->
          <div class="form-section">
            <h4>How do you feel? ?</h4>
            <div class="selection-grid mood-grid">
              <div 
                *ngFor="let mood of motherMoodOptions"
                class="selection-option mood-option"
                [class.selected]="selectedMotherMood?.value === mood.value"
                (click)="selectMotherMood(mood)">
                <div class="mood-emoji-circle">{{ mood.emoji }}</div>
                <span class="option-label">{{ mood.label }}</span>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-section">
            <h4>Your notes ?</h4>
            <div class="form-group">
              <ion-item lines="none" class="input-item">
                <ion-textarea
                  formControlName="notes"
                  placeholder="Write here more about your feed"
                  rows="3"
                  autoGrow="true">
                </ion-textarea>
              </ion-item>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <ion-button 
              expand="block" 
              (click)="saveGrowthRecord()"
              [disabled]="!addRecordForm.valid || !selectedBreastSide || !selectedMotherMood"
              class="save-button">
              Accept
            </ion-button>
          </div>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Weight & Size Record Modal -->
  <ion-modal [isOpen]="showAddWeightModal" (didDismiss)="closeAddWeightModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Weight & Size</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeAddWeightModal()">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <form [formGroup]="addWeightForm" class="add-record-form">
          
          <!-- Baby Info Header -->
          <div class="baby-info-header" *ngIf="selectedBaby">
            <div class="baby-avatar">
              <ion-icon name="happy"></ion-icon>
            </div>
            <div class="baby-details">
              <h3>{{ selectedBaby.name }}</h3>
              <p>{{ calculateBabyAge() }}</p>
            </div>
          </div>

          <!-- Smart Voice Input Section for Weight -->
          <div class="smart-voice-section" *ngIf="isVoiceSupported()">
            <div class="voice-input-header">
              <h5>üé§ Smart Voice Input</h5>
              <p>Say something like: "Baby weighs 4.2 kilograms and is 58 centimeters long"</p>
            </div>
            
            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="startSmartVoiceInputWeight()"
              [disabled]="isRecordingWeight || isProcessingVoiceWeight"
              class="smart-voice-button">
              <ion-icon [name]="isRecordingWeight ? 'stop' : 'mic'" slot="start"></ion-icon>
              <span *ngIf="!isRecordingWeight && !isProcessingVoiceWeight">Start Voice Input</span>
              <span *ngIf="isRecordingWeight">Listening...</span>
              <span *ngIf="isProcessingVoiceWeight">Processing...</span>
            </ion-button>
            
            <div class="voice-status" *ngIf="voiceTranscriptWeight || isProcessingVoiceWeight">
              <div class="voice-transcript" *ngIf="voiceTranscriptWeight">
                <h6>Voice Input:</h6>
                <p>"{{ voiceTranscriptWeight }}"</p>
              </div>
              
              <div class="voice-summary">
                <p class="summary-text">{{ getVoiceInputSummaryWeight() }}</p>
                <ion-button fill="clear" size="small" (click)="clearVoiceInputWeight()">
                  <ion-icon name="close" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </div>
            
            <div class="voice-examples">
              <h6>Example phrases:</h6>
              <ul>
                <li>"Baby weighs 3.8 kilograms"</li>
                <li>"Weight is 4.2kg and height is 55cm"</li>
                <li>"Baby is 4 kilos and 58 centimeters long"</li>
              </ul>
            </div>
          </div>

          <!-- Date Selection -->
          <div class="form-section">
            <h4>üìÖ Date</h4>
            <div class="form-group">
              <ion-item lines="none" class="input-item">
                <ion-icon name="calendar-outline" slot="start" class="input-icon"></ion-icon>
                <ion-datetime-button datetime="weightDate">
                  <ion-label>Date</ion-label>
                </ion-datetime-button>
              </ion-item>
              <ion-modal [keepContentsMounted]="true">
                <ng-template>
                  <ion-datetime 
                    id="weightDate" 
                    formControlName="date"
                    presentation="date"
                    max="2025-12-31"
                    min="2020-01-01">
                  </ion-datetime>
                </ng-template>
              </ion-modal>
            </div>
          </div>

          <!-- Weight & Height -->
          <div class="form-section">
            <h4>‚öñÔ∏è Measurements</h4>
            
            <div class="form-group">
              <label class="field-label">Weight (kg) *</label>
              <ion-item lines="none" class="input-item">
                <ion-input
                  formControlName="weight"
                  type="number"
                  step="0.01"
                  placeholder="What is the baby's weight?"
                  [class.error]="addWeightForm.get('weight')?.invalid && addWeightForm.get('weight')?.touched">
                </ion-input>
              </ion-item>
              <div class="error-message" *ngIf="addWeightForm.get('weight')?.invalid && addWeightForm.get('weight')?.touched">
                {{ getErrorMessage('weight') }}
              </div>
            </div>
            
            <div class="form-group">
              <label class="field-label">Height (cm)</label>
              <ion-item lines="none" class="input-item">
                <ion-input
                  formControlName="height"
                  type="number"
                  step="0.1"
                  placeholder="What is the baby's length?">
                </ion-input>
              </ion-item>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-section">
            <h4>üìù Notes</h4>
            <div class="form-group">
              <ion-item lines="none" class="input-item">
                <ion-textarea
                  formControlName="notes"
                  placeholder="Any additional notes..."
                  rows="3"
                  autoGrow="true">
                </ion-textarea>
              </ion-item>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <ion-button 
              expand="block" 
              (click)="saveWeightRecord()"
              [disabled]="!addWeightForm.valid"
              class="save-button">
              Accept
            </ion-button>
          </div>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Stool Track Modal -->
  <ion-modal [isOpen]="showAddStoolModal" (didDismiss)="closeAddStoolModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Stool track</ion-title>
          <ion-buttons slot="start">
            <ion-button (click)="closeAddStoolModal()">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-buttons slot="end">
            <ion-button fill="clear">
              <ion-icon name="settings" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <form [formGroup]="addStoolForm" class="add-record-form stool-form">
          
          <!-- Baby Info Header -->
          <div class="baby-info-header" *ngIf="selectedBaby">
            <div class="baby-avatar">
              <ion-icon name="happy"></ion-icon>
            </div>
            <div class="baby-details">
              <h3>{{ selectedBaby.name }}</h3>
              <p>{{ calculateBabyAge() }}</p>
            </div>
          </div>

          <!-- Smart Voice Input Section for Stool -->
          <div class="smart-voice-section" *ngIf="isVoiceSupported()">
            <div class="voice-input-header">
              <h5>üé§ Smart Voice Input</h5>
              <p>Say something like: "Baby had a mustard yellow, soft, tablespoon-sized stool"</p>
            </div>
            
            <ion-button 
              expand="block" 
              fill="outline" 
              (click)="startSmartVoiceInputStool()"
              [disabled]="isRecordingStool || isProcessingVoiceStool"
              class="smart-voice-button">
              <ion-icon [name]="isRecordingStool ? 'stop' : 'mic'" slot="start"></ion-icon>
              <span *ngIf="!isRecordingStool && !isProcessingVoiceStool">Start Voice Input</span>
              <span *ngIf="isRecordingStool">Listening...</span>
              <span *ngIf="isProcessingVoiceStool">Processing...</span>
            </ion-button>
            
            <div class="voice-status" *ngIf="voiceTranscriptStool || isProcessingVoiceStool">
              <div class="voice-transcript" *ngIf="voiceTranscriptStool">
                <h6>Voice Input:</h6>
                <p>"{{ voiceTranscriptStool }}"</p>
              </div>
              
              <div class="voice-summary">
                <p class="summary-text">{{ getVoiceInputSummaryStool() }}</p>
                <ion-button fill="clear" size="small" (click)="clearVoiceInputStool()">
                  <ion-icon name="close" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </div>
            
            <div class="voice-examples">
              <h6>Example phrases:</h6>
              <ul>
                <li>"Dark green, liquid, coin-sized stool"</li>
                <li>"Mustard yellow, pasty, tablespoon size"</li>
                <li>"Very dark, hard, bigger than usual"</li>
              </ul>
            </div>
          </div>

          <!-- Time Selection -->
          <div class="form-section">
            <h4>‚è∞ Time</h4>
            <div class="form-group">
              <ion-item lines="none" class="input-item time-input">
                <ion-input
                  formControlName="time"
                  type="time"
                  [class.error]="addStoolForm.get('time')?.invalid && addStoolForm.get('time')?.touched">
                </ion-input>
              </ion-item>
            </div>
          </div>

          <!-- Color Selection -->
          <div class="form-section">
            <h4>üé® Color</h4>
            <div class="selection-grid color-grid">
              <div 
                *ngFor="let color of stoolColorOptions"
                class="selection-option color-option"
                [class.selected]="selectedStoolColor?.value === color.value"
                (click)="selectStoolColor(color)">
                <div class="color-circle" [style.background-color]="color.color"></div>
                <span class="option-label">{{ color.label }}</span>
              </div>
            </div>
          </div>

          <!-- Texture Selection -->
          <div class="form-section">
            <h4>üîç Texture</h4>
            <div class="selection-grid texture-grid">
              <div 
                *ngFor="let texture of stoolTextureOptions"
                class="selection-option texture-option"
                [class.selected]="selectedStoolTexture?.value === texture.value"
                (click)="selectStoolTexture(texture)">
                <div class="texture-icon">
                  <ion-icon [name]="texture.icon"></ion-icon>
                </div>
                <span class="option-label">{{ texture.label }}</span>
              </div>
            </div>
          </div>

          <!-- Size Selection -->
          <div class="form-section">
            <h4>üìè Size</h4>
            <div class="selection-grid size-grid">
              <div 
                *ngFor="let size of stoolSizeOptions"
                class="selection-option size-option"
                [class.selected]="selectedStoolSize?.value === size.value"
                (click)="selectStoolSize(size)">
                <div class="size-icon">
                  <ion-icon [name]="size.icon"></ion-icon>
                </div>
                <span class="option-label">{{ size.label }}</span>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-section">
            <h4>üìù Notes</h4>
            <div class="form-group">
              <ion-item lines="none" class="input-item">
                <ion-textarea
                  formControlName="notes"
                  placeholder="Write about your baby's stool..."
                  rows="3"
                  autoGrow="true">
                </ion-textarea>
              </ion-item>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <ion-button 
              expand="block" 
              (click)="saveStoolRecord()"
              [disabled]="!addStoolForm.valid || !selectedStoolColor || !selectedStoolTexture || !selectedStoolSize"
              class="save-button">
              Accept
            </ion-button>
          </div>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>