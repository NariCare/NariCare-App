<ion-header>
  <ion-toolbar>
    <ion-title>Notification Preferences</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()" fill="clear">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="notifications-outline" style="margin-right: 8px;"></ion-icon>
        Notification Settings
      </ion-card-title>
      <ion-card-subtitle>
        Choose which notifications you'd like to receive
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <!-- Article Updates -->
        <ion-item>
          <ion-icon name="document-text-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>{{ getPreferenceTitle('articleUpdates') }}</h3>
            <p>{{ getPreferenceDescription('articleUpdates') }}</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="preferences.articleUpdates"
            (ionChange)="onPreferenceChange('articleUpdates', $event.detail.checked)"
            [disabled]="isLoading">
          </ion-toggle>
        </ion-item>

        <!-- Call Reminders -->
        <ion-item>
          <ion-icon name="calendar-outline" slot="start" color="success"></ion-icon>
          <ion-label>
            <h3>{{ getPreferenceTitle('callReminders') }}</h3>
            <p>{{ getPreferenceDescription('callReminders') }}</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="preferences.callReminders"
            (ionChange)="onPreferenceChange('callReminders', $event.detail.checked)"
            [disabled]="isLoading">
          </ion-toggle>
        </ion-item>

        <!-- Group Messages -->
        <ion-item>
          <ion-icon name="chatbubbles-outline" slot="start" color="secondary"></ion-icon>
          <ion-label>
            <h3>{{ getPreferenceTitle('groupMessages') }}</h3>
            <p>{{ getPreferenceDescription('groupMessages') }}</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="preferences.groupMessages"
            (ionChange)="onPreferenceChange('groupMessages', $event.detail.checked)"
            [disabled]="isLoading">
          </ion-toggle>
        </ion-item>

        <!-- Growth Reminders -->
        <ion-item>
          <ion-icon name="trending-up-outline" slot="start" color="warning"></ion-icon>
          <ion-label>
            <h3>{{ getPreferenceTitle('growthReminders') }}</h3>
            <p>{{ getPreferenceDescription('growthReminders') }}</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="preferences.growthReminders"
            (ionChange)="onPreferenceChange('growthReminders', $event.detail.checked)"
            [disabled]="isLoading">
          </ion-toggle>
        </ion-item>

        <!-- Expert Messages -->
        <ion-item>
          <ion-icon name="person-circle-outline" slot="start" color="tertiary"></ion-icon>
          <ion-label>
            <h3>{{ getPreferenceTitle('expertMessages') }}</h3>
            <p>{{ getPreferenceDescription('expertMessages') }}</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="preferences.expertMessages"
            (ionChange)="onPreferenceChange('expertMessages', $event.detail.checked)"
            [disabled]="isLoading">
          </ion-toggle>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Push Notification Settings -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="phone-portrait-outline" style="margin-right: 8px;"></ion-icon>
        Push Notification Settings
      </ion-card-title>
      <ion-card-subtitle>
        Manage your device notification settings
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item>
          <ion-icon name="refresh-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Refresh Notification Token</h3>
            <p>Update your device's push notification token if notifications aren't working</p>
          </ion-label>
          <ion-button 
            fill="outline" 
            size="small" 
            (click)="refreshPushToken()"
            [disabled]="isLoading">
            Refresh
          </ion-button>
        </ion-item>
      </ion-list>

      <ion-note class="ion-padding-start">
        <ion-icon name="information-circle-outline" style="margin-right: 4px;"></ion-icon>
        Push notifications require permission from your device settings. 
        If you're not receiving notifications, please check your device's notification settings.
      </ion-note>

      <!-- Debug Information (only show in development) -->
      <ion-item *ngIf="tokenStatus.hasToken" lines="none" class="debug-info">
        <ion-icon name="bug-outline" slot="start" color="medium"></ion-icon>
        <ion-label>
          <h3>Token Status (Debug)</h3>
          <p>
            Token registered: {{ tokenStatus.lastRegistrationDate ? (tokenStatus.lastRegistrationDate | date:'short') : 'Never' }}
          </p>
          <p *ngIf="tokenStatus.daysSinceRegistration !== null">
            Days since registration: {{ tokenStatus.daysSinceRegistration }}
          </p>
          <p>
            Needs refresh: {{ tokenStatus.needsRefresh ? 'Yes' : 'No' }}
          </p>
        </ion-label>
      </ion-item>
    </ion-card-content>
  </ion-card>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button 
      expand="block" 
      fill="solid" 
      (click)="close()"
      [disabled]="isLoading">
      Done
    </ion-button>
  </ion-toolbar>
</ion-footer>