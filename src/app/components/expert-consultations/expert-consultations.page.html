<div class="expert-consultations">
  <div class="section-header">
    <h2 class="section-title">My Consultations</h2>
    <ion-button fill="clear" size="small" (click)="retryLoadConsultations()" *ngIf="consultationsError">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Retry
    </ion-button>
  </div>
  
  <!-- Tab Navigation -->
  <div class="consultation-tabs">
    <button 
      class="tab-button" 
      [class.active]="selectedTab === 'upcoming'"
      (click)="switchTab('upcoming')">
      Upcoming ({{ upcomingConsultations.length }})
    </button>
    <button 
      class="tab-button" 
      [class.active]="selectedTab === 'history'"
      (click)="switchTab('history')">
      History ({{ completedConsultations.length + pastConsultations.length }})
    </button>
  </div>
  
  <!-- Loading state -->
  <div *ngIf="consultationsLoading" class="loading-container">
    <ion-spinner name="circles"></ion-spinner>
    <p>Loading consultations...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="consultationsError && !consultationsLoading" class="error-container">
    <ion-icon name="warning-outline" class="error-icon"></ion-icon>
    <p class="error-message">{{ consultationsError }}</p>
    <ion-button fill="outline" size="small" (click)="retryLoadConsultations()">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Retry
    </ion-button>
  </div>

  <!-- Tab Content -->
  <div *ngIf="!consultationsLoading && !consultationsError" class="consultations-list">
    <div *ngFor="let consultation of getTabConsultations()" class="consultation-card" 
         [class.upcoming]="consultation.status === 'scheduled'"
         [class.completed]="consultation.status === 'completed'"
         [class.cancelled]="consultation.status === 'cancelled'"
         [class.in-progress]="consultation.status === 'in-progress'"
         [class.clickable]="true"
         (click)="openConsultationDetail(consultation)">
      
      <div class="consultation-status-badge" [attr.data-status]="consultation.status">
        {{ consultation.status | titlecase }}
      </div>
      
      <div class="consultation-content">
        <div class="consultation-header">
          <div class="consultation-icon">
            <ion-icon name="videocam"></ion-icon>
          </div>
          <div class="consultation-info">
            <h4>{{ consultation.topic | titlecase }}</h4>
            <p class="client-name">Client: {{ getClientName(consultation) }}</p>
          </div>
        </div>
        
        <div class="consultation-details">
          <div class="detail-item">
            <ion-icon name="calendar" class="detail-icon"></ion-icon>
            <span>{{ (consultation.scheduledAt || consultation.scheduled_at) | date:'MMM d, y' }}</span>
          </div>
          <div class="detail-item">
            <ion-icon name="time" class="detail-icon"></ion-icon>
            <span>{{ (consultation.scheduledAt || consultation.scheduled_at) | date:'h:mm a' }}</span>
          </div>
          <div class="detail-item" *ngIf="consultation.notes">
            <ion-icon name="document-text" class="detail-icon"></ion-icon>
            <span class="notes">{{ consultation.notes }}</span>
          </div>
        </div>
        
        <div class="consultation-actions">
          <!-- Upcoming consultations: Show Join Call -->
          <ion-button 
            *ngIf="selectedTab === 'upcoming' && (consultation.status === 'scheduled' || consultation.status === 'in-progress')"
            fill="solid" 
            size="small"
            (click)="joinConsultation(consultation); $event.stopPropagation()"
            class="join-button">
            <ion-icon name="videocam" slot="start"></ion-icon>
            Join Call
          </ion-button>
          
          <!-- History consultations: Show patient info and report buttons -->
          <div *ngIf="selectedTab === 'history'" class="history-actions">
            <ion-button 
              fill="outline" 
              size="small"
              (click)="viewPatientInformation(consultation); $event.stopPropagation()"
              class="patient-info-button">
              <ion-icon name="person" slot="start"></ion-icon>
              View Patient Information
            </ion-button>
            
            <ion-button 
              fill="outline" 
              size="small"
              (click)="addSummaryReport(consultation); $event.stopPropagation()"
              class="summary-report-button">
              <ion-icon name="document-text" slot="start"></ion-icon>
              Add Summary/Report
            </ion-button>
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="getTabConsultations().length === 0" class="empty-state">
      <ion-icon name="calendar-outline" class="empty-icon"></ion-icon>
      <p class="empty-message">
        {{ selectedTab === 'upcoming' ? 'No upcoming consultations' : 'No consultation history' }}
      </p>
    </div>
  </div>
</div>